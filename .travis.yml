language: cpp
os:
- linux
- osx
addons:
  code_climate:
    repo_token: "d220cd4236a5f28ed7eaa865f718b4f81fa22d988644a89b3589bc019c70da1b"
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - g++-4.8-multilib
    - gcc-multilib
    - build-essential
    - libbluetooth-dev
    - libudev-dev
    - libusb-1.0-0-dev
env:
  matrix:
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="amd64" MAIN_BUILD=true
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
matrix:
  exclude:
  - os: osx
    env: PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
before_install:
- PACKAGER_URL="https://meshblu-connector.octoblu.com/tools/packager/v6.0.11"
- curl -fsS "${PACKAGER_URL}/travis_install_node.sh" -o /tmp/travis_install_node.sh
- curl -fsS "${PACKAGER_URL}/build.sh" -o /tmp/build.sh
- chmod +x /tmp/travis_install_node.sh
- chmod +x /tmp/build.sh
- . /tmp/travis_install_node.sh
install:
- npm install --build-from-source
script:
- npm test
before_deploy:
- if [ "$TRAVIS_OS_NAME" == "osx" ]; then export PACKAGER_OS="darwin"; fi
- if [ "$TRAVIS_OS_NAME" == "linux" ]; then export PACKAGER_OS="linux"; fi
- if [ "$TRAVIS_OS_NAME" == "linux" && "$MAIN_BUILD" == "true" ]; then export NPM_PUBLISH=true; fi
- export PACKAGER_CONNECTOR="$(echo "$TRAVIS_REPO_SLUG" | sed 's/^[A-Za-z0-9]*\/meshblu-connector-//g')"
- export PACKAGER_TAG="$TRAVIS_TAG"
- . /tmp/build.sh
deploy:
- provider: s3
  access_key_id: AKIAJH2D5IPIRHYJT5IA
  secret_access_key:
    secure: "efEQq0Ho/dnkhQGEOVC4H0YBhvDw8C6tRiM3EMfJ0t9gRbbF9JY9wgjp7bKL7Wp4qRHetr3DA3L/9Fe2YerhTDZvdRDgAF4lf+U6mEvoYvwYAEUO1K0/48d6bb7mEx6uPEvTQYjKq4jzU1H4un8559FYZDv2S7EHCIw5dFOBZCrtCgyuU6DaxZ8aMctahKEhnHoPlIfZvvP4GktUdkEiikbTBk05gUpNf2i8DpsXEt09gbJXlVxb+9DEao09xkrVVJEH2f91nFNGa/y0bpt2GhMAR1BhOkU/0SLMU8TV9VuwHwX+Glm4R+N/lDU6b+64SlN/Gw3K07VDpBzMoHVg0cIuKOyoaA65gL2HlHtiYa/XI4WVeXkUGa4m4MnkY1qGt6CZN6/a4Q0nKMGXCC2V2433YllPTyMAPhL9wec3+pcsH6C04kREjhi7ZADmdBiocTwQ9cggTAuJCwYJVBpFhXCGQa+YXdYdLmLl3RCjb8YJuZBMN3dWbxmyX4tbuAebyYM0jY96CP2TWzRtfJn/p34XqPkhfJE8shBlw9qsSI+PWCbaermXxlvqM1Mea6IqmTw8DneuVfZmi8uY+YplX7vZ9TP9TWCEOi2n7zA2OTT3/GcZWI3FzFOxAtSxY2LgCVF9LaCGcIbc16RrBL/yfBpNYxpwogI8UATn2Fy85sw="
  bucket: meshblu-connector
  local-dir: deploy
  upload-dir: connectors
  region: us-west-2
  skip_cleanup: true
  on:
    tags: true
- provider: npm
  email: serveradmin@octoblu.com
  api_key:
    secure: yp+gaExXvHlY5rpvq+4f1eySA2xHrr6RSNN2+HZFFYcR5Pb9lkYMQv9ydLbQwhHmDG1gFbV9cdmqtUMvnoKE3+6F7ztlJH3G2UeXtW6TlrJMq5+PJ+Eeeu6XX+FuLHKirMDO3fxGGCBMvrgMP4r/jsjaRbgzKQHI5BiGWN4+xBpseNPaG9+msp+GofVZAJikN7s6bIgR8SQbwHz56ZpThBWN3goKtOmwq0+FzDiIkrfGfjLxL57QSBwSurPhN2gclvuGn6HBJHV0oUT0WjVEA5oJCpQmtybjsezhJXvHwSIaLlIzAJ0Mw8wZr8fvUaYKaxVJM3WVv9763iGYNxXb/LKltsMkWp2cSHpDw5Fq6U5cD0bo6GBZYdNh3nXqKU+bfh7h+1GVwj4PhwISe0yXbU0uXaKDN3Fd3+1ls1RAd++a3suWKaJDe/W/REkkzZif3wrMfQ2z1uQ2byGJNeXeuKS0DiYg0H+U4eU8reIRsO1ByV4y+YUK74vIicp7qeibXDHJ8DfnBv7ErFdKskDQGTi7inQRRhp4PE3iOglq1hC3TEWEgkGOshp+cVOOWsniyWOSgA4Y9tSZBRnaPkw0XYvAiE0svop5BjxIrQAw8zCXHgcfN7SKOJs4bM3DwFKKk3gX+je3coyc3Y73goUyk1geAKX49bzssuNYmZjXRPo=
  on:
    tags: true
    condition: "$NPM_PUBLISH=true"
