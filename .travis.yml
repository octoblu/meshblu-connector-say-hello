language: cpp
os:
- linux
- osx
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - g++-4.8-multilib
    - gcc-multilib
    - build-essential
    - libbluetooth-dev
    - libudev-dev
    - libusb-1.0-0-dev
env:
  matrix:
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="amd64" MAIN_BUILD="true"
  - PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
  global:
    secure: AhiC4hTRBECnwzSA28Q840aHYC1j4qPoxXJbUWSAvwrUEGiCNW6Z1DvTWgZIv8M9uax5lEZeGtZQJh+YYMYXkB3B3y9wESeFqZDlgjf6LwTXkyfvQQPElwBJbNWySs4i+46wl9QfTuRqyKdY50vVs8ka7KNp43pJOHLC6Sgil3aEKMvwAkLxnYcPGEWaIMU8aJ0PeM4L49lGLNHX2SX05Wv2XQju+l1ih3u3gXKM99//6NZcv/59m+UREEHpMxCcpOr2fW0tKZcADwZff3TIB3Gt8umckoj8ss04Gjd7eg3Btw+up1499ghDcVrXXs9rhWSmCVM3u+GtubvgqkU49u6tGvcnKwId2rCLldRU9Aq6/VAUqr92+N5rZNK/hoQgYZ9qlYAlAtkYvjkKARARxIr3vuHM2yAkVv7IHJdUJW3Cki5k3281tjPdWRLJpn0+uyK+4j/ksuY6H3kDi4GaQBBRGsfL7Zq74t85tTnOFcG/3651WSlZ0VAvdDaX5N9DibQpXa/bJkNK081gwMQl/s69ChBLNRwvaX3uXoBIx2rpC6aho8GdBmUI0NPzBnEAoLeg13MrqtZQGGLx18+J2bZxnefO0+F8wvewPViE5ug5YAwYZxSF7hFRNcAH3wZmb2jPyvGfS+SNScgza8LVEx1epwV5CDEhLuf6yShR9Cs=
matrix:
  exclude:
  - os: osx
    env: PACKAGER_NODE_VERSION="5.5" PACKAGER_ARCH="386"
branches:
  only:
  - "/^v[0-9]/"
before_install:
- PACKAGER_URL="https://meshblu-connector.octoblu.com/tools/packager/latest"
- curl -fsS "${PACKAGER_URL}/travis_install_node.sh" -o /tmp/travis_install_node.sh
- chmod +x /tmp/travis_install_node.sh
- ". /tmp/travis_install_node.sh"
- if [ "$TRAVIS_OS_NAME" == "linux" -a "$MAIN_BUILD" == "true" ]; then export NPM_PUBLISH="true"; fi
install:
- npm install --build-from-source
script:
- npm test
before_deploy:
- npm run package
deploy:
- provider: releases
  api_key:
    secure: "x0387w+8us7tWpCkxST1wgFF4KZxwsLiEAoXCs7iiPe4RD2It8Ds8qpHzz+JLGauMkJeUdzvCJM7gEBiw0gZaujO19MnT75+tvrfnyydY53yEIGCaMqJp1BluO9QoS4S1M8Utq6sF5MwbmRNORVVaX5I9ceG5qI92I69FeYrlvi/8/eMudaNvsehYiIWFKuTZ8R63a4vjNIMBlv3qCeLLG8O32Nmr+uLybB7MEo1yU77zUfzCrv5oop744C6scmfGua43gJjB4QBFkVoymGz+RekFgHH4PcrV5QXz2QQDv5uC9iOT6/SoQk6dUo0zo2eFFoFu/U/uN0y2kiR39v6Oenb2pGXkTUhDAEN0ZVxGf9UjOZlirKrQkH8R2vNoXpsLxx7RXq631LDBQvQ3eik0Y2+jUg5PzwSMX11s/4Op4Gif6AChHWuYfTnomCAW/BEVHIeZK98LwmITb7VDD544czQq4rW24rtZrsovrVrpsK612HmuWHjhU9m2t87HbAZmtlRcwCQtIZezac2pTrtyAaCpuoKFViuGEwiQU3rt10si6/C9SYOtxA7654BiT6jlUFJs1M2d0WFef6cD7HJDscikQqiUaJl+RPL1g8/NzBWRpWKv/UnldE2On+F0vmy7V8CmgaiZ8+PLlhjiDUep7UveNBb7FoLZAjbuqB/ZEc="
  file:
  - "deploy/*"
  skip_cleanup: true
  on:
    tags: true
- provider: npm
  email: serveradmin@octoblu.com
  api_key:
    secure: yp+gaExXvHlY5rpvq+4f1eySA2xHrr6RSNN2+HZFFYcR5Pb9lkYMQv9ydLbQwhHmDG1gFbV9cdmqtUMvnoKE3+6F7ztlJH3G2UeXtW6TlrJMq5+PJ+Eeeu6XX+FuLHKirMDO3fxGGCBMvrgMP4r/jsjaRbgzKQHI5BiGWN4+xBpseNPaG9+msp+GofVZAJikN7s6bIgR8SQbwHz56ZpThBWN3goKtOmwq0+FzDiIkrfGfjLxL57QSBwSurPhN2gclvuGn6HBJHV0oUT0WjVEA5oJCpQmtybjsezhJXvHwSIaLlIzAJ0Mw8wZr8fvUaYKaxVJM3WVv9763iGYNxXb/LKltsMkWp2cSHpDw5Fq6U5cD0bo6GBZYdNh3nXqKU+bfh7h+1GVwj4PhwISe0yXbU0uXaKDN3Fd3+1ls1RAd++a3suWKaJDe/W/REkkzZif3wrMfQ2z1uQ2byGJNeXeuKS0DiYg0H+U4eU8reIRsO1ByV4y+YUK74vIicp7qeibXDHJ8DfnBv7ErFdKskDQGTi7inQRRhp4PE3iOglq1hC3TEWEgkGOshp+cVOOWsniyWOSgA4Y9tSZBRnaPkw0XYvAiE0svop5BjxIrQAw8zCXHgcfN7SKOJs4bM3DwFKKk3gX+je3coyc3Y73goUyk1geAKX49bzssuNYmZjXRPo=
  on:
    tags: true
    condition: "$NPM_PUBLISH = true"
